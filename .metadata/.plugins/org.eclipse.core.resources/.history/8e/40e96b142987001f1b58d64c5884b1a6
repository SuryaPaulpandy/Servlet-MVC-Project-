package Practice_Jdnbc;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.util.Scanner;

public class Practice1 {

	public static void main(String[] args) throws Exception {
		Scanner sc = new Scanner(System.in);
		System.out.println("1.Register Page");
		System.out.println("2.Login Page");
		System.out.println("Enter Your Choice: ");
		int choice1 = sc.nextInt();
		switch (choice1) {
		case 1:
			Register();
			break;
		case 2:
			Login();
			break;
		default:
			System.out.println("Invalid Choice");
			break;
		}

		System.out.println("1.Book Ticked");
		System.out.println("2.Cancel Ticked");

		System.out.println("Enter your choice");
		int choice = sc.nextInt();
		switch (choice) {
		case 1:
			BookingTicked();
			break;
		case 2:
			CancelTicked();
			break;
		default:
			System.out.println("Invalid Choice");
			break;
		}
	}

// Register PAge
	static void Register() throws Exception {
		DriverManager.registerDriver(new com.mysql.cj.jdbc.Driver());
		Connection con = DriverManager.getConnection("jdbc:mysql://localhost:3306/june_2024", "root", "root");

		Scanner sc = new Scanner(System.in);
		System.out.println("Enter your name: ");
		String name = sc.next();
		System.out.println("Enter your username:");
		String username = sc.next();

		while (true) {
			String s = "select*from Register where username=?";
			PreparedStatement pstmt = con.prepareStatement(s);
			pstmt.setString(1, username);
			ResultSet res = pstmt.executeQuery();

			if (res.next()) {
				System.out.println("Username already exists.Please enter another username");
				username = sc.next();
			} else
				break;
		}

		String password;
		String CPassword;
		do {
			System.out.println("Enter Password:");
			password = sc.next();
			System.out.println("Enter Conform Password: ");
			CPassword = sc.next();
		} while (!password.equals(CPassword));

		String s1 = "Insert into Register Values(?,?,?)";
		PreparedStatement pstmt1 = con.prepareStatement(s1);
		pstmt1.setString(1, name);
		pstmt1.setString(2, username);
		pstmt1.setString(3, password);

		pstmt1.executeUpdate();

		System.out.println("Registered Successfully!!!");

	}

	static void Login() throws Exception {
		DriverManager.registerDriver(new com.mysql.cj.jdbc.Driver());
		Connection con = DriverManager.getConnection("jdbc:mysql://localhost:3306/june_2024", "root", "root");

		Scanner sc = new Scanner(System.in);
		System.out.println("Enter Your username: ");
		String username = sc.next();

		ResultSet res1;
		do {
			String s = "select * from Users where username=?";
			PreparedStatement pstmt = con.prepareStatement(s);
			pstmt.setString(1, username);
			res1 = pstmt.executeQuery();

			if (!res1.next()) {
				System.out.println("Invalid Username");
				username = sc.next();
			}
		} while (res1.next());

		System.out.println("Enter your Password");
		String password = sc.next();

		ResultSet res2;
		do {
			String s2 = "select * from Users where password=?";
			PreparedStatement pstmt1 = con.prepareStatement(s2);
			pstmt1.setString(1, password);
			res2 = pstmt1.executeQuery();

			if (!res2.next()) {
				System.out.println("Invalid Password");
				password = sc.next();
			}
		} while (res2.next());

		System.out.println("login Successfully");

	}
//Booking ticket
	static void BookingTicked() throws Exception {
		DriverManager.registerDriver(new com.mysql.cj.jdbc.Driver());
		Connection con = DriverManager.getConnection("jdbc:mysql://localhost:3306/june_2024", "root", "root");

		Scanner sc = new Scanner(System.in);
		System.out.println("Book your Reservation");
		System.out.println("Enter a Passenger Name:");
		String Pname = sc.next();

		System.out.println("Enter a Username: ");
		String Uname = sc.next();

		ResultSet res1;
		do {
			String s = "select * from Register where username=?";
			PreparedStatement pstmt = con.prepareStatement(s);
			pstmt.setString(1, Uname);
			res1 = pstmt.executeQuery();

			if (!res1.next()) {
				System.out.println("Invalid Username");
				Uname = sc.next();
			}
		} while (res1.next());

		System.out.println("Enter a Age: ");
		int Age = sc.nextInt();
		System.out.println("Enter a gender: ");
		String Gender = sc.next();
		System.out.println("Enter a Mobile Number: ");
		long Mnumber = sc.nextLong();
		System.out.println("Enter a Booking Date: ");
		String Bdate = sc.next();
		System.out.println("Enter a Pickup Point: ");
		String Ppoint = sc.next();
		System.out.println("Enter a Drop Point: ");
		String Dpoint = sc.next();
		System.out.println("Enter a Seat Number:");
		int Seat = sc.nextInt();

		String s1 = "Insert into Booking Values(?,?,?,?,?,?,?,?,?)";
		PreparedStatement pstmt = con.prepareStatement(s1);
		pstmt.setString(1, Pname);
		pstmt.setString(2, Uname);
		pstmt.setInt(3, Age);
		pstmt.setString(4, Gender);
		pstmt.setLong(5, Mnumber);
		pstmt.setString(6, Bdate);
		pstmt.setString(7, Ppoint);
		pstmt.setString(8, Dpoint);
		pstmt.setInt(9, Seat);
		pstmt.executeUpdate();

		System.out.println("Your Ticked Was Booking Successfully , Enjoy the Travel");

	}
//Cancel Ticket
	static void CancelTicked() throws Exception {
		DriverManager.registerDriver(new com.mysql.cj.jdbc.Driver());
		Connection con = DriverManager.getConnection("jdbc:mysql://localhost:3306/june_2024", "root", "root");

		Scanner sc = new Scanner(System.in);
		System.out.println("Enter your username");
		String username = sc.next();

		ResultSet res1 = null;
		do {
			String s = "delete from Booking where username=?";
			PreparedStatement pstmt = con.prepareStatement(s);
			pstmt.setString(1, username);
			res1 = pstmt.executeQuery(s);

			if (!res1.next()) {
				System.out.println("Invalid Username");
				username = sc.next();
			}
		} while (res1.next());

		System.out.println("Successfully cancel your ticked");

	}

}
